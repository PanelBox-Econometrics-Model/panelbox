# Count Models Tutorial Outputs

**Version:** 1.0.0
**Last Updated:** 2026-02-16

This directory contains all outputs generated by the count models tutorials, including figures, tables, and saved results.

---

## Overview

Outputs are organized by type and tutorial to facilitate:
- Easy retrieval and reference
- Reproducibility verification
- Comparison across tutorials
- Reuse in presentations or reports

**Note:** This directory is typically excluded from version control (`.gitignore`) since outputs can be regenerated from notebooks. However, directory structure is preserved with `.gitkeep` files.

---

## Directory Structure

```
outputs/
├── figures/           # All plots and visualizations
│   ├── 01_poisson/    # Tutorial 01 figures
│   ├── 02_negbin/     # Tutorial 02 figures
│   ├── 03_fe_re/      # Tutorial 03 figures
│   ├── 04_ppml/       # Tutorial 04 figures
│   ├── 05_zinb/       # Tutorial 05 figures
│   ├── 06_marginal/   # Tutorial 06 figures
│   └── 07_case_study/ # Tutorial 07 figures
├── tables/            # Formatted result tables
│   ├── 01_poisson/
│   ├── 02_negbin/
│   ├── 03_fe_re/
│   ├── 04_ppml/
│   ├── 05_zinb/
│   ├── 06_marginal/
│   └── 07_case_study/
└── results/           # Model objects and diagnostics
    ├── model_objects/ # Serialized fitted models (.pkl)
    └── diagnostics/   # Diagnostic test results (.json, .csv)
```

---

## Figures Directory

### Purpose
Store all plots and visualizations generated in tutorials.

### File Naming Convention

**Format:** `{notebook}_{figure_type}_{description}.png`

**Examples:**
- `01_poisson_histogram_visits.png`
- `02_negbin_variance_mean_plot.png`
- `03_fe_re_residuals_panel.png`
- `04_ppml_gravity_distance_decay.png`

### Subdirectories by Tutorial

#### `figures/01_poisson/`
Expected outputs:
- Histogram of outcome distribution
- OLS vs Poisson comparison
- Residual plots
- Predicted vs observed plots
- IRR forest plot

#### `figures/02_negbin/`
Expected outputs:
- Variance-mean plots
- Rootogram (Poisson vs NB)
- Overdispersion diagnostics
- Model comparison plots

#### `figures/03_fe_re/`
Expected outputs:
- Within and between variation
- Time trends by entity
- Fixed effects estimates
- Hausman test visualization

#### `figures/04_ppml/`
Expected outputs:
- Gravity equation fit
- Distance decay curve
- Zero vs positive flows
- HDFE diagnostics

#### `figures/05_zinb/`
Expected outputs:
- Zero-inflation diagnostics
- Two-process illustration
- Vuong test results
- Predicted probabilities by group

#### `figures/06_marginal/`
Expected outputs:
- AME plots with confidence intervals
- MEM vs MER comparison
- Marginal effects by covariate levels
- Counterfactual simulations

#### `figures/07_case_study/`
Expected outputs:
- Full diagnostic suite
- Model comparison plots
- Robustness check results
- Publication-ready figures

### Specifications

**Format:** PNG (recommended for quality and compatibility)
**Resolution:** 300 DPI (publication quality)
**Size:** Typically 8×6 inches (standard) or 12×8 (wide plots)

**Creating publication-quality figures in notebooks:**
```python
import matplotlib.pyplot as plt

fig, ax = plt.subplots(figsize=(8, 6), dpi=300)
# ... plotting code ...
plt.tight_layout()
plt.savefig(
    '../outputs/figures/01_poisson/histogram_visits.png',
    dpi=300,
    bbox_inches='tight',
    facecolor='white'
)
plt.close()
```

---

## Tables Directory

### Purpose
Store formatted tables (coefficient tables, summary statistics, test results).

### File Naming Convention

**Format:** `{notebook}_table_{number}_{description}.{ext}`

**Extensions:**
- `.csv`: For programmatic use and further analysis
- `.tex`: For LaTeX documents
- `.html`: For web viewing

**Examples:**
- `01_poisson_table_01_descriptive_stats.csv`
- `02_negbin_table_02_model_comparison.tex`
- `03_fe_re_table_03_hausman_test.csv`

### Subdirectories by Tutorial

Each tutorial subdirectory contains numbered tables in order of appearance in the notebook.

#### Common Table Types

**Table 01:** Descriptive statistics
```
Variable        Mean    Std Dev    Min    Max    N
visits          4.2     2.3        0      25     2000
age            45.3    18.2       18      85     2000
...
```

**Table 02:** Model comparison
```
Specification      Log-Lik    AIC      BIC     N
OLS               -7842.3    15694.6  15723.1  2000
Poisson           -7654.1    15318.2  15346.7  2000
Neg. Binomial     -7651.8    15315.6  15349.3  2000
```

**Table 03:** Coefficient estimates
```
Variable      Coef    SE      z      P>|z|   [95% CI]
age          0.015   0.003   5.21   0.000   [0.009, 0.021]
income      -0.002   0.001  -2.15   0.032   [-0.004, -0.000]
...
```

### Creating Tables in Notebooks

```python
import pandas as pd

# Create summary table
summary = result.summary_frame()
summary.to_csv(
    '../outputs/tables/01_poisson/table_01_coefficients.csv',
    float_format='%.4f'
)

# LaTeX format
with open('../outputs/tables/01_poisson/table_01_coefficients.tex', 'w') as f:
    f.write(summary.to_latex(float_format='%.4f'))
```

---

## Results Directory

### Purpose
Store model objects and diagnostic results for:
- Reproducibility
- Further analysis without re-fitting
- Comparison across specifications

### `model_objects/` Subdirectory

**Purpose:** Serialized fitted models using pickle

**File Naming:** `{notebook}_{model_name}.pkl`

**Examples:**
- `01_poisson_main_model.pkl`
- `02_negbin_type2_model.pkl`
- `07_case_study_final_specification.pkl`

**Saving models:**
```python
import pickle

# Fit model
result = model.fit()

# Save
with open('../outputs/results/model_objects/01_poisson_main_model.pkl', 'wb') as f:
    pickle.dump(result, f)
```

**Loading models:**
```python
import pickle

with open('../outputs/results/model_objects/01_poisson_main_model.pkl', 'rb') as f:
    result = pickle.load(f)

# Use loaded result
print(result.summary())
```

**Warning:** Pickle files are Python version and library version specific. If PanelBox is updated, you may need to refit models.

### `diagnostics/` Subdirectory

**Purpose:** Store diagnostic test results in structured formats

**Formats:**
- JSON: For structured diagnostic results
- CSV: For tabular diagnostics

**Examples:**
- `02_negbin_overdispersion_test.json`
- `03_fe_re_hausman_test.csv`
- `05_zinb_vuong_test.json`

**JSON Example:**
```json
{
    "test_name": "Overdispersion Test",
    "notebook": "02_negbin",
    "alpha": 0.524,
    "se_alpha": 0.089,
    "z_stat": 5.88,
    "p_value": 0.000,
    "conclusion": "Reject equidispersion; use Negative Binomial"
}
```

**Saving diagnostics:**
```python
import json

diagnostics = {
    'test_name': 'Overdispersion Test',
    'alpha': float(alpha),
    'p_value': float(p_value),
    'conclusion': conclusion
}

with open('../outputs/results/diagnostics/02_negbin_overdispersion.json', 'w') as f:
    json.dump(diagnostics, f, indent=2)
```

---

## Regenerating Outputs

### From Notebooks

All outputs can be regenerated by running the notebooks:

```bash
cd notebooks
jupyter nbconvert --to notebook --execute 01_poisson_introduction.ipynb
```

Or run all notebooks:
```bash
for notebook in *.ipynb; do
    jupyter nbconvert --to notebook --execute "$notebook"
done
```

### Using Papermill

For automated regeneration with different parameters:

```bash
pip install papermill

papermill \
    notebooks/01_poisson_introduction.ipynb \
    notebooks/01_poisson_introduction_output.ipynb \
    -p output_dir '../outputs'
```

---

## Output Management

### Cleaning Outputs

To remove all generated outputs (e.g., before committing):

```bash
# Remove all figures
rm -rf outputs/figures/*/*.png

# Remove all tables
rm -rf outputs/tables/*/*.csv
rm -rf outputs/tables/*/*.tex

# Remove all results
rm -rf outputs/results/model_objects/*.pkl
rm -rf outputs/results/diagnostics/*.json

# Keep directory structure
find outputs -type d -empty -exec touch {}/.gitkeep \;
```

### Selective Cleaning

Remove outputs from specific tutorial:
```bash
rm -rf outputs/figures/01_poisson/*
rm -rf outputs/tables/01_poisson/*
```

---

## Version Control

### .gitignore Recommendations

Add to `.gitignore`:
```gitignore
# Generated outputs (can be reproduced)
examples/count/outputs/figures/*.png
examples/count/outputs/tables/*.csv
examples/count/outputs/tables/*.tex
examples/count/outputs/results/model_objects/*.pkl
examples/count/outputs/results/diagnostics/*.json

# Keep directory structure
!examples/count/outputs/figures/.gitkeep
!examples/count/outputs/tables/.gitkeep
!examples/count/outputs/results/model_objects/.gitkeep
!examples/count/outputs/results/diagnostics/.gitkeep
```

### When to Commit Outputs

Generally, don't commit outputs. However, consider committing:
- Example outputs for documentation
- Benchmark results for testing
- Final publication figures (if space permits)

---

## Best Practices

### 1. Consistent Naming

Follow naming conventions strictly for easy retrieval:
```python
# Good
filename = '01_poisson_histogram_visits.png'

# Bad
filename = 'histogram.png'  # Which tutorial?
filename = 'fig1.png'       # What does it show?
```

### 2. Metadata in Filenames

Include key information:
```python
# Good: notebook_type_specification_date.png
filename = '07_case_study_marginal_effects_main_spec.png'

# Helps identify: which notebook, what type, which specification
```

### 3. Don't Overwrite

If creating multiple versions:
```python
# Use version suffix
fig.savefig('../outputs/figures/01_poisson/histogram_visits_v1.png')
fig.savefig('../outputs/figures/01_poisson/histogram_visits_v2.png')

# Or use dates
from datetime import datetime
date_str = datetime.now().strftime('%Y%m%d')
fig.savefig(f'../outputs/figures/01_poisson/histogram_visits_{date_str}.png')
```

### 4. Document Custom Outputs

If creating additional outputs, document in notebook:
```markdown
## Additional Outputs

This notebook generates the following supplementary outputs:
- `sensitivity_analysis_plot.png`: Sensitivity to alpha parameter
- `robustness_table.csv`: Results with alternative specifications
```

---

## Reusing Outputs

### In LaTeX Documents

```latex
\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth]{../panelbox/examples/count/outputs/figures/01_poisson/histogram_visits.png}
    \caption{Distribution of doctor visits}
    \label{fig:visits_hist}
\end{figure}
```

### In Markdown/Reports

```markdown
![Visit Distribution](outputs/figures/01_poisson/histogram_visits.png)
```

### In Presentations

Import high-DPI PNG files directly into PowerPoint, Keynote, or Beamer.

---

## Troubleshooting

### Issue: File Not Found When Saving

**Cause:** Subdirectory doesn't exist

**Solution:**
```python
from pathlib import Path

output_path = Path('../outputs/figures/01_poisson')
output_path.mkdir(parents=True, exist_ok=True)

fig.savefig(output_path / 'histogram_visits.png')
```

### Issue: Permission Denied

**Cause:** File open in another program or read-only

**Solution:**
- Close file in other programs
- Check file permissions: `chmod +w filename.png`

### Issue: Large File Sizes

**Cause:** High DPI or inefficient format

**Solution:**
```python
# Reduce DPI for draft figures
fig.savefig('output.png', dpi=150)  # Instead of 300

# Or use vector format for scalable graphics
fig.savefig('output.pdf')  # Vector, smaller for simple plots
```

### Issue: Corrupted Pickle Files

**Cause:** Python/library version mismatch

**Solution:**
Don't rely on pickle across versions. Refit models as needed.

---

## Summary

- **Figures:** `outputs/figures/{notebook}/` → PNG, 300 DPI
- **Tables:** `outputs/tables/{notebook}/` → CSV, LaTeX, HTML
- **Results:** `outputs/results/model_objects/` → Pickle files
- **Diagnostics:** `outputs/results/diagnostics/` → JSON, CSV

All outputs are regenerable from notebooks. Keep directory structure, but exclude files from version control.

---

For questions about specific outputs, refer to the generating notebook or the tutorial README.
